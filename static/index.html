<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL AI Agent</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Configuration</h2>
                <button id="toggle-sidebar" class="icon-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <div class="sidebar-content">
                <!-- Database Connection Status & Selection -->
                <section class="config-section">
                    <h3>Database</h3>

                    <div class="connection-status-card" id="conn-status-card">
                        <div class="status-row">
                            <span class="status-dot disconnected" id="status-dot"></span>
                            <span id="status-text">Disconnected</span>
                        </div>
                        <button id="btn-configure-db" class="btn secondary small">Configure Connection</button>
                    </div>

                    <div class="input-group" id="db-select-group" style="display: none; margin-top: 1rem;">
                        <label for="db-name">Select Database</label>
                        <div class="select-wrapper">
                            <select id="db-name" name="database">
                                <option value="" disabled selected>Select Database</option>
                                <!-- Populated via JS -->
                            </select>
                            <button type="button" id="refresh-dbs" class="icon-btn small"
                                title="Refresh Databases">↻</button>
                        </div>
                    </div>
                </section>

                <hr>

                <!-- LLM Configuration -->
                <!-- LLM Configuration -->
                <section class="config-section">
                    <h3>AI Model Settings</h3>
                    <form id="llm-config-form">
                        <div class="input-group">
                            <label for="llm-provider">Provider</label>
                            <select id="llm-provider" name="provider">
                                <option value="local">Local (Ollama)</option>
                                <option value="openrouter">OpenRouter</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="llm-model">Model</label>
                            <input list="llm-models-list" id="llm-model" name="model"
                                placeholder="Type to search or select..." required>
                            <datalist id="llm-models-list">
                                <!-- Populated dynamically -->
                            </datalist>
                        </div>
                        <div class="input-group" id="api-key-group" style="display: none;">
                            <label for="llm-api-key">API Key</label>
                            <input type="password" id="llm-api-key" name="api_key"
                                placeholder="Enter OpenRouter API Key">
                        </div>
                        <button type="submit" class="btn secondary">Update & Save Settings</button>
                    </form>
                </section>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-interface">
            <header class="chat-header">
                <button id="open-sidebar" class="icon-btn" style="display: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
                <div class="header-status">
                    <h1>SQL AI Agent</h1>
                </div>
            </header>

            <div class="chat-history" id="chat-history">
                <!-- Messages will be injected here -->
                <div class="message ai">
                    <div class="avatar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 4V6M12 18V20M6 12H4M20 12H18M15.54 15.54L14.12 14.12M9.88 9.88L8.46 8.46M15.54 8.46L14.12 9.88M9.88 14.12L8.46 15.54"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="message-content">
                        <p>Hello! I am your SQL AI Agent. Connect a database and ask me anything about your data.</p>
                    </div>
                </div>
            </div>

            <div class="chat-input-area">
                <form id="chat-form">
                    <input type="text" id="user-input" placeholder="Ask a question about your database..."
                        autocomplete="off">
                    <button type="submit" class="btn send-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 2L11 13M22 2L15 22L11 13M11 13L2 9L22 2" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                </form>
            </div>
        </main>
    </div>

    <!-- Modal for DB Config -->
    <div id="db-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connection Settings</h3>
                <button id="close-modal" class="icon-btn">✕</button>
            </div>
            <form id="db-config-form">
                <div class="input-group">
                    <label for="db-host">Host</label>
                    <input type="text" id="db-host" name="host" value="127.0.0.1" required>
                </div>
                <div class="input-group">
                    <label for="db-port">Port</label>
                    <input type="number" id="db-port" name="port" value="3306" required>
                </div>
                <div class="input-group">
                    <label for="db-user">User</label>
                    <input type="text" id="db-user" name="user" value="root" required>
                </div>
                <div class="input-group">
                    <label for="db-pass">Password</label>
                    <input type="password" id="db-pass" name="password" required>
                </div>
                <!-- Database name is optional here, we want to just connect then list -->
                <div class="input-group">
                    <label for="db-default">Default Database (Optional)</label>
                    <input type="text" id="db-default" name="database" placeholder="mysql">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn primary">Connect</button>
                </div>
            </form>
        </div>
    </div>

    <script src="main.js"></script>
</body>

</html>